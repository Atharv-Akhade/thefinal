<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout ‚Äî AI Car Comparison</title>
<style>
  body { font-family: Arial,sans-serif; background:#111; color:#eee; margin:0; }
  .wrap { max-width:1000px; margin:0 auto; padding:20px; }
  .header { background:#000; padding:12px 20px; display:flex; align-items:center; }
  .header .title { font-weight:bold; font-size:22px; }
  .header .subtitle { font-size:14px; color:#aaa; }
  .catalog-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:20px; margin-top:20px; }
  .catalog-item { background: rgba(255,255,255,0.05); border-radius:10px; padding:12px; display:flex; flex-direction:column; align-items:center; }
  .catalog-item img { width:100%; height:180px; object-fit:cover; border-radius:8px; }
  .catalog-item h4 { margin:10px 0 6px; font-size:18px; text-align:center; }
  .catalog-item p { margin:2px 0; font-size:14px; }
  .total-price { margin-top:20px; font-size:20px; text-align:right; font-weight:bold; }

  /* Floating buttons */
  #whatsappBtn, #chatbotBtn { position:fixed; bottom:20px; right:20px; background:#25d366; color:#fff; border:none; border-radius:50%; width:60px; height:60px; font-size:28px; cursor:pointer; display:flex; align-items:center; justify-content:center; text-decoration:none; box-shadow:0 4px 10px rgba(0,0,0,0.4); transition:transform 0.2s; }
  #whatsappBtn:hover, #chatbotBtn:hover { transform:scale(1.1); }
  #chatbotBtn { right:90px; background:#007bff; }

  footer { text-align:center; padding:20px; margin-top:40px; color:#aaa; }

  /* Chatbot popup */
  #chatbotModal {
    position: fixed;
    bottom: 100px;
    right: 20px;
    width: 320px;
    max-height: 450px;
    background: #1a1a1a;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.6);
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 9999;
    animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn { from {opacity:0; transform:translateY(30px);} to {opacity:1; transform:translateY(0);} }

  .chatbot-header {
    background: #007bff;
    color: #fff;
    padding: 10px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .chatbot-header button {
    background: none;
    border: none;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
  }
  .chatbot-body {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 14px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .chat-msg {
    padding: 8px 12px;
    border-radius: 14px;
    max-width: 80%;
    animation: slideIn 0.3s ease;
  }
  @keyframes slideIn { from {transform:translateY(10px); opacity:0;} to {transform:translateY(0); opacity:1;} }
  .user-msg { background: #007bff; color: #fff; align-self: flex-end; }
  .bot-msg { background: #333; color: #eee; align-self: flex-start; }
  .chatbot-footer {
    display: flex;
    border-top: 1px solid #333;
  }
  .chatbot-footer input {
    flex: 1;
    padding: 8px;
    border: none;
    outline: none;
    background: #222;
    color: #eee;
    font-size: 14px;
  }
  .chatbot-footer button {
    background: #007bff;
    border: none;
    color: #fff;
    padding: 0 15px;
    cursor: pointer;
    font-size: 14px;
    
  }

  /* Catchy line animation */
  @keyframes fadeSlide {
    from { opacity:0; transform:translateY(-10px); }
    to { opacity:1; transform:translateY(0); }
  }
    #whatsappBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #25D366;
    color: #fff;
    font-size: 1.8rem;
    padding: 14px;
    border-radius: 50%;
    text-decoration: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    z-index: 1000;

    /* Continuous pulsing animation */
    animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
    0% { transform: scale(1); box-shadow: 0 4px 12px rgba(0,0,0,0.6); }
    50% { transform: scale(1.1); box-shadow: 0 6px 16px rgba(0,0,0,0.8); }
    100% { transform: scale(1); box-shadow: 0 4px 12px rgba(0,0,0,0.6); }

  }
  #chatbotBtn {
    position: relative;
    bottom: 7px;          /* Same as WhatsApp */
     
    left: 1345px;         /* Increased space so they don‚Äôt overlap */
    background: #007bff;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    
}
</style>
</head>
<body>

<header class="header wrap">
  <div>
    <div class="title">AI Car Comparison</div>
    <div class="subtitle">Checkout</div>
    <div style="text-align: center; margin-top: 20px;">
      <a href="index.html">
        <button style="
          padding: 10px 20px; 
          border: none; 
          border-radius: 6px; 
          background-color: #555; 
          color: #fff; 
          cursor: pointer;
          transition: background-color 0.3s;
        " onmouseover="this.style.backgroundColor='#333'" onmouseout="this.style.backgroundColor='#555'">
          ‚Üê Back to Home
        </button>
      </a>
    </div>
  </div>
</header>

<main class="wrap">
  <h1>Your Selected Cars</h1>

  <p style="font-size:18px; text-align:center; color:#00e6e6; background:rgba(255,255,255,0.05); padding:12px; border-radius:10px; animation:fadeSlide 1.2s ease;">
    üöó Want to buy this car? Have a talk with our dealer about <b>booking, payment, or more exciting details</b> of your dream ride today!Click the green chat button to connect directly with the dealer!
  </p>
  

  <div id="catalogList" class="catalog-grid"></div>
  <div class="total-price" id="totalPrice">Grand Total: ‚Çπ0</div>
</main>

<a href="#" target="_blank" id="whatsappBtn" title="Contact Dealer via WhatsApp">üí¨</a>
<button id="chatbotBtn" title="Open Chatbot">ü§ñ</button>

<div id="chatbotModal">
  <div class="chatbot-header">
    Chatbot
    <button id="closeChatbot">‚úñ</button>
  </div>
  <div class="chatbot-body" id="chatbotBody">
    <div class="bot-msg chat-msg">Hi üëã! You can ask questions or leave feedback about this website.</div>
  </div>
  <div class="chatbot-footer">
    <input type="text" id="chatbotInput" placeholder="Type your message...">
    <button id="sendChatbot">Send</button>
  </div>
</div>

<footer>¬© Driving Innovation ‚Ä¢ AI Car Comparison</footer>

<script>
window.addEventListener("DOMContentLoaded", () => {
    const catalogList = document.getElementById("catalogList");
    const totalPriceEl = document.getElementById("totalPrice");

    // --- Get selected car IDs from purchase page ---
    const selectedIds = JSON.parse(localStorage.getItem("selectedCars") || "[]");
    const catalog = JSON.parse(localStorage.getItem("myCatalog") || "[]");

    if(selectedIds.length === 0){
        catalogList.innerHTML = '<p style="color:#aaa;text-align:center;">No cars selected for checkout.</p>';
        totalPriceEl.textContent = "Grand Total: ‚Çπ0";
        return;
    }

    let grandTotal = 0;
    catalogList.innerHTML = "";

    selectedIds.forEach(id => {
        const car = catalog.find(c => String(c.id) === String(id));
        if(!car) return;

        // --- FIX: Read price from JSON dataset properly ---
        let rawPrice = null;
        if(car.raw && car.raw["Cars Prices"]) rawPrice = car.raw["Cars Prices"];
        else if(car["Cars Prices"]) rawPrice = car["Cars Prices"];
        if(!rawPrice) rawPrice = "$10000";
        rawPrice = String(rawPrice).replace(/[^0-9.]/g,"");
        const usdPrice = parseFloat(rawPrice) || 10000;

        const priceInr = Math.round(usdPrice * 83);
        const gst = Math.round(priceInr * 0.18);
        const ins = Math.round(priceInr * 0.05);
        const total = priceInr + gst + ins;
        grandTotal += total;

        const div = document.createElement("div");
        div.className = "catalog-item";
        div.innerHTML = `
            <img src="${car.image}" alt="${car.model}">
            <h4>${car.brand} ${car.model}</h4>
            <p><b>Fuel:</b> ${car.raw?.["Fuel Types"]||"N/A"}</p>
            <p><b>Engine:</b> ${car.raw?.Engines||"N/A"}</p>
            <p><b>Base Price:</b> ‚Çπ${priceInr.toLocaleString()}</p>
            <p><b>GST (18%):</b> ‚Çπ${gst.toLocaleString()}</p>
            <p><b>Insurance (5%):</b> ‚Çπ${ins.toLocaleString()}</p>
            <p><b>Total:</b> ‚Çπ${total.toLocaleString()}</p>
        `;
        catalogList.appendChild(div);
    });

    totalPriceEl.textContent = `Grand Total: ‚Çπ${grandTotal.toLocaleString()}`;

    // WhatsApp button
    const whatsappBtn = document.getElementById("whatsappBtn");
    whatsappBtn.addEventListener("click", () => {
        const models = selectedIds.map(id => {
            const car = catalog.find(c => String(c.id) === String(id));
            return car ? car.brand + " " + car.model : "";
        }).filter(Boolean).join(", ");
        const message = encodeURIComponent(`Hello, I'm interested in: ${models}`);
        whatsappBtn.href = `https://wa.me/9870149876?text=${message}`;
    });

    // Chatbot
    const chatbotBtn = document.getElementById("chatbotBtn");
    const chatbotModal = document.getElementById("chatbotModal");
    const closeChatbot = document.getElementById("closeChatbot");
    const chatbotBody = document.getElementById("chatbotBody");
    const chatbotInput = document.getElementById("chatbotInput");
    const sendChatbot = document.getElementById("sendChatbot");

    chatbotBtn.addEventListener("click", () => {
        chatbotModal.style.display = "flex";
        chatbotInput.focus();
    });
    closeChatbot.addEventListener("click", () => {
        chatbotModal.style.display = "none";
    });

    function addMessage(text, type){
        const div = document.createElement("div");
        div.className = type + "-msg chat-msg";
        div.textContent = text;
        chatbotBody.appendChild(div);
        chatbotBody.scrollTop = chatbotBody.scrollHeight;
    }

    function botReply(userText) {
        let text = userText.toLowerCase();
        let reply = "I'm here to help! Could you please clarify your question?";
        if (text.includes("hi") || text.includes("hello") || text.includes("hey")) reply = "Hey! How are you doing today?";
        addMessage(reply,"bot");
    }

    function sendMessage(){
        const text = chatbotInput.value.trim();
        if(!text) return;
        addMessage(text,"user");
        chatbotInput.value = "";
        setTimeout(()=>botReply(text),800);
    }
    sendChatbot.addEventListener("click", sendMessage);
    chatbotInput.addEventListener("keypress", e => { if(e.key==="Enter") sendMessage(); });
});
</script>

</body>
</html>
